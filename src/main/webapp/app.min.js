angular.module("gp",["templates","ui.ace","ngDialog","LocalStorageModule"]).config(["localStorageServiceProvider",function(e){e.setPrefix("groovyplayground")}]),angular.module("gp").controller("EditorController",["$scope","$http","$q","ngDialog","localStorageService",function(e,t,n,o,r){var i,u,a="source",c=ace.require("ace/range").Range,l=[];e.source=r.get(a);var s=n.defer(),f=function(){return s.promise};e.evaluate=function(){r.set(a,e.source),e.result={},e.output=[],e.isLoading=!0,i&&i.resolve();var o=n.defer();i=o,t.post("/api/script",{source:e.source},{timeout:i.promise}).then(function(t){e.result=t.data;var n=[[]],o=0;angular.forEach(e.result.output,function(e){n[o].push(e),e.lineBreak&&(n.push([]),o++)}),0===n[n.length-1].length&&n.splice(-1),e.output=n,e.interactiveOutput=!0})["finally"](function(){o===i&&(i=null,e.isLoading=!1)})},e.aceLoaded=function(e){s.resolve(e),e.focus()},e.highlightLine=function(t){e.interactiveOutput&&f().then(function(e){l.forEach(function(t){e.getSession().removeMarker(t)}),t>=0&&l.push(e.getSession().addMarker(new c(t,0,t,1),"output-cause-line","fullLine"))})},e.showInfo=function(){o.open({template:"views/info.html",className:"ngdialog-theme-default wide-dialog info-dialog"})},e.$watch("interactiveOutput",function(t,n){t&&!n&&(u=e.$watch("source",function(t,n){t!==n&&(f().then(function(e){e.getSession().clearAnnotations()}),e.interactiveOutput=!1,u())}))}),e.$watch("result",function(e){if(e&&e.output){var t=e.output.filter(function(e){return"EXCEPTION"===e.type||"COMPILATION_ERROR"===e.type});f().then(function(e){e.getSession().setAnnotations(t.map(function(e){return{row:e.line-1,text:e.message,type:"error"}}))})}})}]),angular.module("gp").directive("clickHotkey",["$document",function(e){var t=["shift","ctrl","meta","alt"];return{restrict:"A",scope:{clickHotkey:"@"},link:function(n,o){function r(e){for(var n=0;n<i.length-1;n++){if(-1===t.indexOf(i[n]))throw new Error("Modifier "+i[n]+" does not exist.");if(!e[i[n]+"Key"])return!1}return u.toLowerCase()===e.keyIdentifier.toLowerCase()}var i=n.clickHotkey.split("+"),u=i[i.length-1];e.bind("keypress",function(e){r(e)&&angular.element(o).triggerHandler("click")})}}}]);