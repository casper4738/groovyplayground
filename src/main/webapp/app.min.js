angular.module("gp",["templates","ui.ace","ngDialog","LocalStorageModule"]).config(["localStorageServiceProvider",function(t){t.setPrefix("groovyplayground")}]),angular.module("gp").controller("EditorController",["$scope","$http","$q","ngDialog","localStorageService",function(t,e,n,i,o){var r,u,a="source",c=ace.require("ace/range").Range,l=[];t.source=o.get(a)||"";var s=n.defer(),g=function(){return s.promise};t.evaluate=function(){o.set(a,t.source),t.result={},t.output=[],t.error=null,t.isLoading=!0,r&&r.resolve();var i=n.defer();r=i,e.post("/api/script",{source:t.source},{timeout:r.promise}).then(function(e){t.result=e.data;var n=[[]],i=0;angular.forEach(t.result.output,function(t){n[i].push(t),t.lineBreak&&(n.push([]),i++)}),0===n[n.length-1].length&&n.splice(-1),t.output=n,t.interactiveOutput=!0})["catch"](function(e){418===e.status?(t.interactiveOutput=!1,t.error="DEADLINE_EXCEEDED"):t.error="UNKNOWN"})["finally"](function(){i===r&&(r=null,t.isLoading=!1)})},t.aceLoaded=function(t){s.resolve(t),t.focus()},t.highlightLine=function(e){t.interactiveOutput&&g().then(function(t){l.forEach(function(e){t.getSession().removeMarker(e)}),e>=0&&l.push(t.getSession().addMarker(new c(e,0,e,1),"output-cause-line","fullLine"))})},t.createGist=function(){t.gistCreating=!0,e.post("https://api.github.com/gists",{description:"","public":!1,files:{"script.groovy":{content:t.source}}}).then(function(t){i.open({template:"views/gistcreated.html",data:{url:t.data.html_url},className:"ngdialog-theme-default gist-dialog"})})["catch"](function(){i.open({template:"views/gisterror.html"})})["finally"](function(){t.gistCreating=!1})},t.showInfo=function(){i.open({template:"views/info.html",className:"ngdialog-theme-default wide-dialog info-dialog"})},t.$watch("interactiveOutput",function(e,n){e&&!n&&(u=t.$watch("source",function(e,n){e!==n&&(g().then(function(t){t.getSession().clearAnnotations()}),t.interactiveOutput=!1,u())}))}),t.$watch("result",function(t){if(t&&t.output){var e=t.output.filter(function(t){return"EXCEPTION"===t.type||"COMPILATION_ERROR"===t.type});g().then(function(t){t.getSession().setAnnotations(e.map(function(t){return{row:t.line-1,text:t.message,type:"error"}}))})}})}]),angular.module("gp").directive("clickHotkey",["$document",function(t){return{restrict:"A",link:function(e,n){function i(t){return t.ctrlKey&&(13===t.which||10===t.which)}t.bind("keypress",function(t){i(t)&&angular.element(n).triggerHandler("click")})}}}]);