angular.module("gp",["templates","ui.ace","ngDialog","LocalStorageModule"]).config(["localStorageServiceProvider",function(e){e.setPrefix("groovyplayground")}]),angular.module("gp").controller("EditorController",["$scope","$http","$q","ngDialog","localStorageService",function(e,t,n,o,r){var i,u,a="source",c=ace.require("ace/range").Range,l=[];e.source=r.get(a);var s=n.defer(),f=function(){return s.promise};e.evaluate=function(){r.set(a,e.source),e.result={},e.output=[],e.error=null,e.isLoading=!0,i&&i.resolve();var o=n.defer();i=o,t.post("/api/script",{source:e.source},{timeout:i.promise}).then(function(t){e.result=t.data;var n=[[]],o=0;angular.forEach(e.result.output,function(e){n[o].push(e),e.lineBreak&&(n.push([]),o++)}),0===n[n.length-1].length&&n.splice(-1),e.output=n,e.interactiveOutput=!0})["catch"](function(t){418===t.status?(e.interactiveOutput=!1,e.error="DEADLINE_EXCEEDED"):e.error="UNKNOWN"})["finally"](function(){o===i&&(i=null,e.isLoading=!1)})},e.aceLoaded=function(e){s.resolve(e),e.focus()},e.highlightLine=function(t){e.interactiveOutput&&f().then(function(e){l.forEach(function(t){e.getSession().removeMarker(t)}),t>=0&&l.push(e.getSession().addMarker(new c(t,0,t,1),"output-cause-line","fullLine"))})},e.showInfo=function(){o.open({template:"views/info.html",className:"ngdialog-theme-default wide-dialog info-dialog"})},e.$watch("interactiveOutput",function(t,n){t&&!n&&(u=e.$watch("source",function(t,n){t!==n&&(f().then(function(e){e.getSession().clearAnnotations()}),e.interactiveOutput=!1,u())}))}),e.$watch("result",function(e){if(e&&e.output){var t=e.output.filter(function(e){return"EXCEPTION"===e.type||"COMPILATION_ERROR"===e.type});f().then(function(e){e.getSession().setAnnotations(t.map(function(e){return{row:e.line-1,text:e.message,type:"error"}}))})}})}]),angular.module("gp").directive("clickHotkey",["$document",function(e){return{restrict:"A",link:function(t,n){function o(e){return e.ctrlKey&&(13===e.which||10===e.which)}e.bind("keypress",function(e){o(e)&&angular.element(n).triggerHandler("click")})}}}]);